import{ref,toRefs,computed,refs}from"composition-api";import{nextTick}from"vue";export default function useDropdown(e,t,n){const{maxHeight:o,disabled:l,searchable:i,isSelectAll:r}=toRefs(e),u=n.multiselect,c=n.blurInput,a=n.blurSearch,s=n.clearSearch,d=n.focusInput,p=n.focusSearch,v=n.addOpen,h=ref(!1),g=(ref("dropdown-"+Math.random().toString().replace(".","-")),ref(!1)),y=ref(null),m=ref(null),f=computed(()=>`${o.value}px`),w=computed(()=>`${o.value-2-(r.value?40:0)}px`),x=new IntersectionObserver(function(e){e.forEach(e=>{e.isIntersecting&&e.intersectionRatio<1&&b(e.target)})}),b=t=>{let n=u.value.getBoundingClientRect();"body"===e.container&&(t.style.left=n.x+"px",t.style.top=n.bottom+"px");let o=R().x+R().width,l=R().y+R().height,i=t.getBoundingClientRect().x+t.getBoundingClientRect().width,r=t.getBoundingClientRect().y+t.getBoundingClientRect().height;i>o&&(t.style.removeProperty("left"),t.style.left=n.width-t.getBoundingClientRect().width+"px"),R().height>t.getBoundingClientRect().height&&r>l&&(t.style.removeProperty("top"),t.style.bottom=n.height+"px")},R=()=>"body"===e.container?{x:0,y:0,width:window.innerWidth,height:window.innerHeight}:document.getElementById(e.container).getBoundingClientRect(),S=e=>{e.target.contains(u.value)&&b(m.value)},B=()=>{i&&i.value?a():c()};return{isOpen:h,contentMaxHeight:f,resize:e=>{h.value&&B()},scrollMaxHeight:w,openDropdown:()=>{if(l.value||v.value)return;let n=u.value.querySelector(".multiselect-options"),o=u.value.querySelector(".selectall-button-container");"body"===e.container&&(document.addEventListener("scroll",S,!0),document.body.append(m.value)),h.value=!0,t.emit("open"),nextTick(()=>{u.value.clientWidth>n.clientWidth&&n.style.setProperty("min-width",u.value.clientWidth+"px"),o&&(o.style.width=n.clientWidth+"px"),(e=>{let t=u.value.getBoundingClientRect();e.style.left=0,e.style.top=t.height+"px",e.style.removeProperty("width"),e.style.removeProperty("right"),e.style.removeProperty("bottom")})(n),b(n),g.value||(x.observe(n),g.value=!0)})},closeDropdown:n=>{"body"===e.container&&(document.removeEventListener("scroll",S,!0),y.value.append(m.value)),u.value.querySelector(".multiselect-options").style.removeProperty("min-width"),h.value=!1,s(),t.emit("close")},open:()=>{i&&i.value?p():d()},close:B,handleInputMousedown:e=>{h.value&&!i.value&&(u.value.querySelector(".multiselect-input").dispatchEvent(new Event("blur")),u.value.querySelector(".multiselect-input").blur(),e.preventDefault())},options_container:y,optionRows:m,setScrollPosition:S}};